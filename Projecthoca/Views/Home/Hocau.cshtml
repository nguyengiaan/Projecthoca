@model Projecthoca.Models.EnitityVM.HocaVM
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

}
<!-- Modal cảnh báo xóa-->
<div class="modal fade" id="Xoabancaukh" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Xác nhận xóa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Bạn có chắc chắn muốn xóa khách hàng bàn này không?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="Xacnhanxoa">Xác nhận</button>
            </div>
        </div>
    </div>
</div>
<!--Modal chuyển bàn-->
<div class="modal fade" id="Chuyenban" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered  ">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Chuyển bàn câu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" id="formchuyenban" enctype="multipart/form-data">
                    <div class="form-group">
                        <label class="col-form-label">Bàn câu bạn muốn chuyển</label>
                        <select class="form-select" id="Banmuonchuyen">

                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
                <button type="button" id="submitcbc" class="btn btn-primary">Chuyển bàn câu</button>

            </div>
        </div>
    </div>
</div>
<!--Modal thêm thời gian-->
<div class="modal fade" id="Themthoigian" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered  ">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm thời gian</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" id="formthemtg" enctype="multipart/form-data">
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="Ma_danhmuchoadon" value="">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Ca câu</label>
                        <select class="form-select" id="Ma_giahoca">
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Số lượng</label>
                        <input type="number" class="form-control" id="Soluonggio" value="1">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Trạng thái</label>
                        <select class="form-select" id="Trangthaicacau">
                            <option value="Coca">Có cá</option>
                            <option value="Khongcoca">Không có cá</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
                <button type="button" id="submittg" class="btn btn-primary">Thêm ca câu</button>

            </div>
        </div>
    </div>
</div>
<!--Modal Thêm dịch vụ-->
<div class="modal fade" id="Themdichvu" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="exampleModalLabel">Thêm dịch vụ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" id="formthemdv" enctype="multipart/form-data">
                    <!-- Danh mục dịch vụ -->
                    <div class="mb-4">
                        <label for="Ma_danhmucdv" class="form-label fw-semibold">Danh mục dịch vụ</label>
                        <select id="Ma_danhmucdv" class="form-select form-select-lg">
                            <option selected disabled>Chọn danh mục...</option>
                        </select>
                    </div>

                    <!-- Tìm kiếm dịch vụ -->
                    <div class="mb-4 position-relative">
                        <label for="Ma_danhmuchoadon" hidden class="form-label fw-semibold">Tìm dịch vụ</label>
                        <input type="text" hidden id="Ma_danhmuchoadon" oninput="filterDichvuList()" 
                            class="form-control form-control-lg" placeholder="Nhập tên dịch vụ..." autocomplete="off">
                        <!-- Dropdown danh sách dịch vụ -->
                        <div id="dichvuList" class="dropdown-menu shadow w-100 mt-1" style="display: none;">
                            <table class="table table-hover mb-0">
                                <tbody id="tblbody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Số lượng dịch vụ -->
                    <div class="mb-4">
                        <label for="soluongdm" class="form-label fw-semibold">Số lượng</label>
                        <input type="number" class="form-control form-control-lg" id="soluongdm" value="1" min="1">
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-outline-secondary btn-lg" data-bs-dismiss="modal">Thoát</button>
                <button type="button" id="submitdv" class="btn btn-primary btn-lg">Thêm dịch vụ</button>
            </div>
        </div>
    </div>
</div>



<!--Xem dịch vụ-->
<div class="modal fade" id="Xemdichvu" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Xem các dịch vụ</h5>
                <input type="text" hidden id="nhanvien" name="nhanvien" value="">
                <input type="text" hidden id="tenkhuvuc" name="tenkhuvuc" value="">
                <div class="d-flex flex-row">
                   
                    <button type="button" class="btn btn-info m-2" id="Themthoigianbtn" data-toggle="modal"
                        data-target="#Themthoigian">Thêm ca câu</button>
                    <!-- Di chuyển nút vào trong div d-block d-md-none -->
                    <button type="button" class="btn btn-primary m-2 " id="Themdichvubtn" data-toggle="modal"
                        data-target="#Themdichvu">Thêm dịch vụ</button>
                    @* <button type="button" class="btn btn-success m-2" id="Inhoadon">In hóa đơn</button> *@

                    
                     <button type="button" class="btn btn-primary m-2" id="Themphieuxuatbtn">In hóa đơn</button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"> </button>
                    
                </div>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Danh sách danh mục và thông tin hóa đơn được đặt bên cạnh nhau -->
                    <div class="col-md-6 d-none d-md-block" id="ds1">

                        <div class="p-1">
                            <div class="input-group">
                                <span class="input-group-text">Tìm kiếm</span>
                                <input class="form-control w-5 h-5" aria-label="With textarea" id="search" />
                            </div>
                        </div>

                        <table class="table ">
                            <thead style="border:1px solid black; background:lightblue;">
                                <tr>
                                    <th>Mã danh mục</th>
                                    <th>Tên danh mục</th>
                                    <th>Tồn kho</th>
                                    <th>Giá</th>
                                    <th>Đơn vị tính</th>
                                    <th>Chọn</th>
                                </tr>
                            </thead>
                            <tbody id="danhmuc-list">
                                <!-- Dữ liệu danh mục sẽ được thêm vào đây -->
                            </tbody>
                        </table>
                    
                    </div>

                    <div class="col-md-6" id = "in">
                        <div class="bill-container">
                            <div class="customer-info">
                                <h2>Thông tin khách hàng</h2>
                                <div><span>Tên khu câu:</span><span class="value">Khu vực 7</span></div>
                                <div><span>Tên khách hàng:</span><span class="value">Vũ Văn A</span></div>
                                <div><span>Thời gian bắt đầu câu:</span><span class="value">23:08:00</span></div>
                                <div><span>Thời gian câu:</span><span class="value">03:07:55</span></div>
                            </div>

                            <div class="bill-details">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Mã hàng</th>
                                            <th>Tên hàng</th>
                                            <th>Đơn vị tính</th>
                                            <th>Số lượng</th>
                                            <th>Đơn giá</th>
                                            <th>Thành tiền</th>
                                            <th>Xóa</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dsdv">
                                        <!-- Thông tin dịch vụ được thêm vào đây -->
                                    </tbody>
                                    <tbody>
                                              <tr >
            <td colspan="7" style="text-align:right;">
                <div class="d-flex align-items-center justify-content-end mb-2">
                    <span class="fw-bold me-2">Giảm giá:</span>
                    <input type="number" class="form-control hide-when-print border-secondary" style="max-width: 200px;" id="discount-input">
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="7" style="text-align:right;">
                <div class="d-flex align-items-center justify-content-end mb-2">
                    <span class="fw-bold me-2">Tiền mặt:</span>
                    <input type="number" class="form-control hide-when-print border-secondary" style="max-width: 200px;" id="tienmat">
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="7" style="text-align:right;">
                <div class="d-flex align-items-center justify-content-end mb-2">
                    <span class="fw-bold me-2">Chuyển khoản:</span>
                    <input type="number" class="form-control hide-when-print border-secondary" style="max-width: 200px;" id="chuyenkhoan">
                </div>
            </td>
        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="bill-summary">
                                <div class="bill-total">
                                    <h2>Tổng thanh toán: <span id="tongthanhtoan-outside" style="color:orange;">0</span>
                                    </h2>
                                </div>
                                <div class="Tienthoichokhach">
                                    <h2>Tiền thối lại cho khách: <span id="tongthanhtoan-outside"
                                            style="color:red;">0</span></h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>



<!--Context menu-->
<div id="contextMenu" class="context-menu">
    <ul>
        <li><a href="#" id="Themkh" style="text-decoration: none; color: black;">Cho khách thuê</a></li>
        <li><a href="#" id="Bamgio" style="text-decoration: none; color: black;">Bấm giờ</a></li>
        <li><a href="#" id="Themdichvu" style="text-decoration: none; color: black;">Xem dịch vụ</a></li>
        <li><a href="#" id="Xemchitietca" style="text-decoration: none; color: black;">Xem số cá</a></li>
        <li><a href="#" id="Chuyenban" style="text-decoration: none; color: black;">Chuyển bàn câu</a></li>
    </ul>
</div>

<!--Modal thêm chi tiết cá-->
<div class="modal fade" id="Themchitietca" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered  ">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm chi tiết cá</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" id="formthemca" enctype="multipart/form-data">
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="Ma_thuehoca" value="">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Tên loài cá</label>
                        <select class="form-select" id="Ma_haisan">
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Giờ câu</label>
                        <input type="time" class="form-control" id="giocau">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Số ký</label>
                        <input type="number" class="form-control" id="sokg">
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
                <button type="button" id="submitca" class="btn btn-primary">Thêm cá nè</button>
            </div>
        </div>
    </div>
</div>
<!--Modal xem cá -->
<div class="modal fade" id="Xemca" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Xem cá được câu</h5>
                <div>
                    <button type="button" class="btn btn-primary" id="Themchitietcabtn" data-toggle="modal"
                        data-target="#Themchitietca">Thêm chi tiết cá</button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

            </div>
            <div class="modal-body">
                <div class="bill-container">
                    <div class="customer-info">
                        <h2>Thông tin khách hàng</h2>
                        <div><span>Tên khu câu:</span><span class="value">Khu vực 7</span></div>
                        <div><span>Tên khách hàng:</span><span class="value">Vũ Văn A</span></div>
                        <div><span>Thời gian bắt đầu câu:</span><span class="value">23:08:00</span></div>
                        <div><span>Thời gian câu:</span><span class="value">03:07:55</span></div>
                    </div>
                    <div class="bill-details">
                        <table>
                            <thead>
                                <tr>
                                    <th>Thời Gian</th>
                                    <th>Tên Loại Cá</th>
                                    <th>Trọng Lượng (kg)</th>
                                    <th>Thành tiền (VNĐ)</th>
                                    <th>Xóa</th>
                                </tr>
                            </thead>
                            <tbody id="dsca">
                            </tbody>
                        </table>
                    </div>
                    <div class="bill-total-kg">
                        <h2>Tổng Trọng Lượng Cá Câu Được: <span>11.4 kg</span></h2>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
<!--Modal thêm khách thuê -->
<div class="modal fade" id="Themkhachthuetill" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered ">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm khách thuê</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" id="formkhachthue" enctype="multipart/form-data">
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="Ma_khuvuccau" value="">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Tên khách hàng</label>
                        <input type="text" class="form-control" id="Tenkhachhang" name="Tenkhachhang" value="Khách đi câu">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Ngày câu</label>
                        <input type="date" class="form-control" id="Ngaycau"
                            value="@DateTime.Now.ToString("yyyy-MM-dd")">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Thời gian bắt đầu câu</label>
                        <input type="time" class="form-control" id="Thoigianbatdau">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
                <button type="button" id="submitkt" class="btn btn-primary">Lưu khách thuê</button>
            </div>
        </div>
    </div>
</div>
<!--Modal thêm khu vực-->
<div class="modal fade" id="Themkhuvuchc" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered ">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm khu vực</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" id="formkhuvuc" enctype="multipart/form-data">
                    <div class="form-group">
                        @if (Model != null && Model.Ma_hoca != null)
                        {
                            <input type="hidden" class="form-control" id="Ma_hoca" value="@Model.Ma_hoca">
                        }
                        <input type="hidden" class="form-control" id="Idkhuvuccau_kv" value="">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Tên khu vực câu</label>
                        <input type="text" class="form-control" id="Ten_Khuvuccau" maxlength="10">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">Trạng thái</label>
                        <select class="form-select" id="Trangthai">
                            <option value="Chuacokhach" selected>Chưa có khách</option>

                        </select>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
                <button type="button" id="submitkv" class="btn btn-primary">Lưu khu vực</button>
            </div>
        </div>
    </div>
</div>
<!--Modal thêm hồ câu-->
<div class="modal fade" id="Themhocau" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm hồ câu</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post" id="formThemtaikhoan" enctype="multipart/form-data" asp-action="themhoca"
                    asp-controller="Quanlyhoca">
                    <div class="form-group">
                        <label class="col-form-label" asp-for="Ten_hoca">Tên gọi hồ cá</label>
                        <input asp-for="Ten_hoca" type="text" class="form-control" id="hovaten">
                        <span asp-validation-for="Ten_hoca" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" asp-for="Kieuhoca">Kiểu hồ câu</label>
                        <select asp-for="Kieuhoca" class="form-select" aria-label="Default select example"
                            id="Ma_LoaiPhong" onchange="updateImage()">
                            <option value="hcn" selected>Hồ hình chữ nhật</option>
                        </select>
                        <span asp-validation-for="Kieuhoca" class="text-danger"></span>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="submitBtntk">Thêm hồ câu</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                            id="closeBtn">Close</button>
                    </div>
                </form>

            </div>

        </div>
    </div>
</div>
<!--Modal body-->
<div class="container-fluid">
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <div class="row">
                @if (Model != null && Model.Ten_hoca != null)
                {
                    <div class="col-md-10 col-12" style="display: flex; flex-direction: row; justify-content: space-between;">
                        <div >
                        <h4 class="m-0 font-weight-bold text-primary">@Model.Ten_hoca</h4>
                        </div>
                       
                    </div>

                }
                else
                {
                    <div class="col-md-10 col-12">
                        <h4 class="m-0 font-weight-bold text-primary">Hồ câu á</h4>
                    </div>
                }

                @if (Model != null && Model.Kieuhoca != null)
                {
                    <div class="col-md-2 col-12">
                    </div>
                }
                else
                {
                    <div class="col-md-2 col-12">
                        <button class="btn btn-primary" data-toggle="modal" data-target="#Themhocau">
                            <span class="fs-20">Thêm hồ câu</span>
                        </button>
                    </div>
                }
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                @if (Model != null && Model.Kieuhoca == "hcn")
                {
                    <div class="container" data-id="@Model.Ma_hoca">
                        <div class="top-seats" id="top-seats">
                        </div>
                        <div class="d-flex justify-content-center align-items-center position-relative">
                            <div class="hoca">
                                <div id="lottie-animation"></div>
                            </div>
                        </div>
                        <div class="bottom-seats" id="bottom-seats">
                        </div>
                    </div>
                }
                else
                {
                    <p>Hãy thêm hồ cá </p>
                }

            </div>
        </div>
    </div>
</div>
@section Styles {
    <link rel="stylesheet" href="~/css/hoca.css">
    <link rel="stylesheet" href="~/css/Formchitietcau.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
    <link href="~/Content/css/select2.css" rel="stylesheet" />
    <link href="~/Content/css/select2.min.css" rel="stylesheet" />
    <script src="~/Scripts/select2.js"></script>
    <script src="~/Scripts/select2.min.js"></script>
    <style>

        /* Style for the input field */
#Ma_danhmuchoadon {
    border: 1px solid #ced4da;
    border-radius: 4px;
    padding: 10px;
    width: 100%;
    box-sizing: border-box;
    font-size: 14px;
    outline: none;
}

#Ma_danhmuchoadon:focus {
    border-color: #80bdff;
    box-shadow: 0 0 0 0.2rem rgba(38, 143, 255, 0.25);
}

/* Style for the dropdown menu */
#danhMucList {
    position: absolute;
    top: 100%;
    left: 0;
    background-color: #ffffff;
    border: 1px solid #ced4da;
    border-radius: 4px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    z-index: 1000; /* Ensure it appears above other elements */
}

/* Style for the table in the dropdown menu */
#danhMucList .table {
    margin-bottom: 0;
}

#danhMucList .table-hover tbody tr {
    cursor: pointer;
}

#danhMucList .table-hover tbody tr:hover {
    background-color: #f8f9fa;
}

/* Style for the table cells */
#tblbody td {
    padding: 10px;
    vertical-align: middle;
}

/* Optional: Add padding and margin to the form group */
.form-group {
    margin-bottom: 20px;
}



        /* Kích thước mặc định cho màn hình lớn */
        .select2-container--default .select2-selection--single {
            height: 38px;
            width: 446px;
        }

        /* Điều chỉnh chiều cao của phần tử input trong Select2 */
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 50px;


        }

        /* Điều chỉnh chiều cao của phần tử dropdown */
        .select2-container--default .select2-results>.select2-results__options {
            max-height: 200px;
            max-width: 440px;
        }





        .chongoi {
            cursor: pointer;
        }

        .chongoi:hover {
            background-color: #dc410b;
        }

        .Khuvuc {
            background-image: url('../Admin_Style/img/1.jpg');
            background-color: #dfe6e9;
            width: 90px;
            /* Chiều rộng của chỗ ngồi */
            height: 90px;
            /* Chiều cao của chỗ ngồi */
            margin: 7px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #2d3436;
            cursor: pointer;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        .Khuvuc:hover {
            background-color: #33CCFF;
        }

        .context-menu {
            display: none;
            position: absolute;
            z-index: 1000;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

       .context-menu ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
}

.context-menu ul li {
    padding: 0; /* Đặt padding cho thẻ <li> về 0 để không ảnh hưởng tới thẻ <a> */
    margin-bottom: 0px;
    background-color:white;
   
    transition: background-color 0.1s ease-in-out;
}

.context-menu ul li a {
    display: block;
    padding: 10px 20px; /* Đặt padding cho thẻ <a> để có khoảng cách trong */
    width: 100%;
    height: 100%;
    text-decoration: none;
    color: black;
    box-sizing: border-box; /* Đảm bảo padding không ảnh hưởng tới kích thước tổng của thẻ <a> */
}

.context-menu ul li:hover {
    background-color: #dcdcdc; /* Hiệu ứng hover */
}

        .Cokhach {
            background-image: url('../Admin_Style/img/2.jpg');
            background-color: greenyellow;
            width: 90px;
            /* Chiều rộng của chỗ ngồi */
            height: 90px;
            /* Chiều cao của chỗ ngồi */
            margin: 7px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #2d3436;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .Dangsuachua {
            background-color: yellow;
            width: 90px;
            /* Chiều rộng của chỗ ngồi */
            height: 90px;
            /* Chiều cao của chỗ ngồi */
            margin: 7px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #2d3436;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .status-text {
            font-size: 15px;
            font-weight: normal;
            color: #fff;
            margin-left: 5px;
            text-shadow: -1px -1px 0 #2d3436, 1px -1px 0 #2d3436, -1px 1px 0 #2d3436, 1px 1px 0 #2d3436;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;

        }

        .bill-total {}

        /* Tùy chỉnh chiều rộng của thành phần chosen */
        .chosen-container {
            width: 100% !important;
            /* Điều chỉnh kích thước theo ý muốn */
        }

        .chosen-container .chosen-single {
            height: 40px;
            /* Tăng chiều cao của dropdown */
            font-size: 18px;
            /* Tăng kích thước font */
            line-height: 40px;
            /* Điều chỉnh để văn bản nằm giữa */
        }


        /* Tùy chỉnh chiều cao của các mục trong danh sách */
        .chosen-container .chosen-results li {
            height: 70px;
            /* Điều chỉnh chiều cao theo ý muốn */
        }

        /* Tùy chỉnh font-size của các mục trong danh sách */
        .chosen-container .chosen-results li {
            font-size: 16px;
            /* Điều chỉnh font-size theo ý muốn */
        }
    </style>
    <style>
    /* Ensure the modal has better padding and responsiveness */
    .modal-content {
        border-radius: 10px;
        padding: 1.5rem;
    }
    
    /* Adjust dropdown appearance */
    #dichvuList {
        max-height: 200px;
        overflow-y: auto;
    }
    
    /* Improve appearance of form controls */
    .form-control {
        border: 1px solid #ced4da;
        border-radius: 0.5rem;
        padding: 0.75rem;
    }

    /* Increase button size for mobile-friendliness */
    .btn-lg {
        padding: 0.75rem 1.25rem;
        font-size: 1.125rem;
    }

    /* Add subtle hover effects */
    .btn-primary:hover {
        background-color: #0056b3;
        border-color: #00408a;
    }
</style>
    

}
@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.9.6/lottie.min.js"></script>




    <script>
        var tenNVKD = '';
        var tenKhachHang = '';
        var tenKhuvuc = '';
        var kvc;
        var tongtienthanhtoan = 0;
        var discountValue;
        var cashValue;
        var transferValue;
        var tongtiencuoicung;
        var tienthua;
        var trangthai="Khách đi câu"
        document.addEventListener('DOMContentLoaded', function () {
            const animationPath = '../Admin_Style/img/animation.json';
            lottie.loadAnimation({
                container: document.getElementById('lottie-animation'), // ID của thẻ chứa animation
                renderer: 'svg',
                loop: true,
                autoplay: true,
                path: animationPath
            });
        });
        // sử lý nút đóng modal
        //---------------------------------------------------------------------------
        $('#Themkhuvuchc .btn-close, #Themkhuvuchc .btn-secondary').click(function () {
            $('#Themkhuvuchc').modal('hide');
        });
        $('#Themchitietca .btn-close, #Themchitietca .btn-secondary').click(function () {
            $('#Themchitietca').modal('hide');
        });
        $('#Themdichvu .btn-close, #Themdichvu .btn-secondary').click(function () {
            $('#Themdichvu').modal('hide');
        });
        $('#Themthoigian .btn-close, #Themthoigian .btn-secondary').click(function () {
            $('#Themthoigian').modal('hide');
        });
        $('#Xemca .btn-close, #Xemca .btn-secondary').click(function () {
            $('#Xemca').modal('hide');
        });
        $('#Themkhachthuetill .btn-close, #Themkhachthuetill .btn-secondary').click(function () {
            $('#Themkhachthuetill').modal('hide');
        });
        $('#Chuyenban .btn-close, #Chuyenban .btn-secondary').click(function () {
            $('#Chuyenban').modal('hide');
        });
        $('#Xoabancaukh .btn-close, #Xoabancaukh .btn-secondary').click(function () {
            $('#Xoabancaukh').modal('hide');
        });
        $('#Xemdichvu .btn-close, #Xemdichvu .btn-secondary').click(function () {
            $('#Xemdichvu').modal('hide');
        });
        //--------------------------------------------------------------------------
        $(document).ready(function () {
            $('#Ma_danhmucdv').select2({
                placeholder: "Chọn danh mục",
                allowClear: true,
                dropdownParent: $('#Themdichvu')
            });
            selectbancau();
            Danhsachdv();
            Danhsachcahd();
            danhsachNVKD();
            $(document).on("click", "#Themthoigianbtn", function () {
                $("#Xemdichvu").modal("hide");
            });
            $(document).on("click", "#apply-discount-btn", function () {


                Giamgia()

            });
            $(document).on("click", "#Themdichvubtn", function () {


                $("#Xemdichvu").modal("hide");

            });
            setInterval(function () {
                Danhsachkhuvuc();
                setCurrentTime('#Thoigianbatdau');
                setCurrentTime('#giocau');
                Tinhtienthua();
            }, 1000);
            
            $("#submitkv").click(function () {
                Themkhuvuc();
                
            
            });
            $(document).on('keydown', function (event) {
                        // Kiểm tra nếu phím Enter được nhấn (keyCode 13)
                        if (event.key === "Enter") {
                            event.preventDefault(); // Ngăn chặn hành động mặc định của phím Enter
                            Themkhuvuc(); // Gọi hàm Themmathang()
                        }
                    });
                    
                   Danhsachkhuvuc() ;
                });
            
            $("#Themchitietcabtn").click(function () {
                $('#Xemca').modal('hide');
            });
            Danhsachhs();
            $(document).on("click", ".chongoi", function () {
                var khuVucId_kv = $(this).attr("id");

                // Khởi tạo modal và hiển thị nó
                $("#Themkhuvuchc").modal("show");
                // Cập nhật giá trị của input ẩn
                $("#Idkhuvuccau_kv").val(khuVucId_kv);
            });
            $(document).on("contextmenu touchstart", ".Khuvuc", function (e) {
                e.preventDefault();

                var khuVucId = $(this).data("id");
                Kiemtrakv(khuVucId);
                Kiemtrabamgio(khuVucId);
                kvc = khuVucId;

                // Tính toán tọa độ chính xác
                var x = e.pageX || e.originalEvent.touches[0].pageX;
                var y = e.pageY || e.originalEvent.touches[0].pageY;

                // Hiển thị menu ngữ cảnh
                $("#contextMenu").css({
                    display: "block",
                    left: x,
                    top: y
                }).data("id", khuVucId);
            });
            $(document).click(function () {
                $("#contextMenu").hide();
            });
            $("#contextMenu a").on("click", function (e) {
                e.preventDefault();

                var action = $(this).attr("id");
                var khuVucId = $("#contextMenu").data("id");

                if (action === "edit") {
                    // Handle edit action
                    alert("Edit " + khuVucId);
                } else if (action === "delete") {
                    alert("Delete " + khuVucId);
                } else if (action === "Themkh") {
                    $("#Themkhachthuetill").modal("show");
                    $("#Ma_khuvuccau").val(khuVucId);
                } else if (action === "Bamgio") {
                    Updatebamgio(khuVucId);
                } else if (action === "dungtg") {
                    Dungthoigian(khuVucId);
                } else if (action === "Xoakh") {
                    $('#Xoabancaukh').modal('show');
                } else if (action === "Xoakhuvuc") {
                    Xoakhuvuc(khuVucId);
                } else if (action === "Xemchitietca") {
                    $("#Xemca").modal("show");
                    Xemkhkhuvuc(khuVucId);
                    Danhsachca(khuVucId);
                    Tongsokg(khuVucId);
                } else if (action === "Themdichvu") {
                    tienthua = 0;
                    Tinhtienthua();
                    Xemkhkhuvuc(khuVucId);
                    Danhsachhddv(khuVucId);
                    $("#Xemdichvu").modal("show");
                } else if (action === "Chuyenban") {
                    $("#Chuyenban").modal("show");
                }
                $("#contextMenu").hide();
            });
            $(document).on("click", "#submitkt", function () {
                Themkhachhang();
            });
            $(document).on("click ", "#submitca", function () {
                Themcane();
            });
            $(document).on("click", "#submitdv", function () {
                Themdichvu();
            });
            $(document).on("click ", "#submittg", function () {
                Themthoigian();
            });
            $(document).on("click ", "#submitcbc", function () {
                Chuyenban();
            });
            $(document).on("click ", "#Xacnhanxoa", function () {
                $('#Xoabancaukh').modal('hide')
                Xoakhachang(kvc);

            });
            $(document).on("click ", "#Themphieuxuatbtn", function () {
                $('#ds1').hide();
                Kiemtrabamgioin(kvc);

            })
            @* $(document).on("click ", "#Themphieuxuatbtn", function () {
                Themphieuxuat();
            }); *@

            $(document).on('change', '#Timkiem', function () {
                var Ma_mathang = $(this).val();
                hienthihanghoa(Ma_mathang);
            });
            $(document).on("click", "#btnChondm", function () {
                var data = $(this).data("id");
                Themdichvuhd(data);
                
            })
            
            $(document).on('change', '#Soluong', function () {
                var soluong = $(this).val();
                var ma_danhmuchanghoa = $(this).data("id");
                Capnhatsoluong(ma_danhmuchanghoa, soluong);
            });
            hienthihanghoa()
            $(document).on('change', '#discount-input', function () {
                Tinhtienthua();
                Giamgia();
            });
            $(document).on('change', '#tienmat', function () {
                Tinhtienthua();
            });
            $(document).on('change', '#chuyenkhoan', function () {
                Tinhtienthua();
            });
            
        function formatCurrency1(value) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);
        }
        function Themkhuvuc() {
            var Ma_hoca = $("#Ma_hoca").val();
            var Ten_Khuvuccau = $("#Ten_Khuvuccau").val();
            var Trangthai = $("#Trangthai").val();
            var Ghichu = $("#Ghichu").val();
            var Idkhuvuccau = $("#Idkhuvuccau_kv").val();
            var form = $("#formkhuvuc")[0];
            var formData = new FormData(form);
            formData.append("Ma_hoca", Ma_hoca);
            formData.append("Ten_Khuvuccau", Ten_Khuvuccau);
            formData.append("Trangthai", Trangthai);
            formData.append("Ghichu", Ghichu);
            formData.append("Idkhuvuccau", Idkhuvuccau);
            $.ajax({
                url: "/Khuvuchoca/Themkhuvuc",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.message,
                            icon: "success"
                        });
                        form.reset();
                        $("#Themkhuvuchc").modal("hide");

                        selectbancau();
                    } else {
                        Swal.fire({
                            title: "Thất bại",
                            text: response.message,
                            icon: "error"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Danhsachkhuvuc() {
            var Ma_hoca = $("#Ma_hoca").val();
            $.ajax({
                url: "/Khuvuchoca/Danhsachkhuvuc",
                type: "POST",
                data: { Ma_hocau: Ma_hoca },
                success: function (response) {
                    if (response.success) {

                        var str1 = "";
                        var str2 = "";
                        $("#top-seats").empty();
                        $("#bottom-seats").empty();
                        // Vùng chứa các ghế ở phía trên
                        for (let i = 1; i <= 10; i++) {
                            str1 += `<div class="chongoi" id="${i}" data-id="${i}">+</div>`;
                        }
                        $("#top-seats").append(str1);
                        // Vùng chứa các ghế ở phía dưới
                        for (let i = 11; i <= 21; i++) {
                            str2 += `<div class="chongoi" id="${i}" data-id="${i}">+</div>`;
                        }
                        $("#bottom-seats").append(str2);

                        // Cập nhật các ghế dựa trên dữ liệu từ response.data
                        $.each(response.data, function (index, value) {
                            if (value.idkhuvuccau >= 1 && value.idkhuvuccau <= 21) {
                                const element = $(`#${value.idkhuvuccau}`);
                                element.attr('data-id', value.ma_Khuvuccau);
                                $('.Khuvuc').removeClass('chongoi');
                                if (value.trangthai === "Cokhach") {
                                    element.html(`<span class="status-text">${value.ten_Khuvuccau}</span><span class="status-text">Có khách</span><span class="status-text" id="timeout">${value.timeout}</span>`);
                                    element.addClass("Cokhach");
                                    element.addClass("Khuvuc");
                                    element.removeClass("chongoi");
                                } else if (value.trangthai === "Dangsuachua") {
                                    element.html(`<span class="status-text">${value.ten_Khuvuccau}</span><span class="status-text">Có khách</span>`);
                                    element.addClass("Dangsuachua");
                                    element.addClass("Khuvuc");
                                    element.removeClass("chongoi");
                                } else if (value.trangthai === "Chuacokhach") {
                                    element.html(`<span class="status-text">${value.ten_Khuvuccau}</span>`);
                                    element.addClass("Khuvuc");

                                    element.removeClass("chongoi");

                                }
                            }
                        });
                    } else {
                        Swal.fire({
                            title: "Thất bại",
                            text: response.message,
                            icon: "error"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function setCurrentTime(inputId) {
            var now = new Date();
            var hours = now.getHours().toString().padStart(2, '0');
            var minutes = now.getMinutes().toString().padStart(2, '0');
            var currentTime = hours + ':' + minutes;
            $(inputId).val(currentTime);
        }
        function Themkhachhang() {
            var Tenkhachhang = $("#Tenkhachhang").val();
            var Sodienthoai = $("#Sodienthoai").val();
            var Ngaycau = $("#Ngaycau").val();
            var Thoigianbatdau = $("#Thoigianbatdau").val();
            var Thoigianketthuc = $("#Thoigianketthuc").val();
            var Ma_khuvuccau = $("#Ma_khuvuccau").val();
            var form = $("#formkhachthue")[0];
            var formData = new FormData(form);
            formData.append("Ten_Khachhang", Tenkhachhang);
            formData.append("Sodienthoai", Sodienthoai);
            formData.append("Ngaycau", Ngaycau);
            formData.append("Thoigianbatdau", Thoigianbatdau);
            formData.append("Thoigianketthuc", Thoigianketthuc);
            formData.append("Ma_khuvuccau", Ma_khuvuccau)
            $.ajax({
                url: "/Khuvuchoca/Themkhachthue",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.message,
                            icon: "success"
                        });
                        form.reset();
                        $("#Themkhachthuetill").modal("hide");
                        Danhsachkhuvuc();
                    } else {
                        Swal.fire({
                            title: "Thất bại",
                            text: response.message,
                            icon: "error"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Kiemtrakv(Ma_khuvuc) {

            var formData = new FormData();
            formData.append("Ma_khuvuc", Ma_khuvuc);

            $.ajax({
                url: "/Khuvuchoca/Kiemtrakv",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    var str = '';
                    if (response.success) {
                        var submitButton = document.getElementById('Themkh');
                        submitButton.innerText = 'Xóa khách hàng';
                        submitButton.id = 'Xoakh';

                    } else {
                        var submitButton = document.getElementById('Xoakh');
                        submitButton.innerText = 'Thêm khách hàng ';
                        submitButton.id = 'Themkh';

                    }


                }
            });
        }
        function layThoiGianConLai(khuVucId, element) {
            var formData = new FormData();
            formData.append("Ma_khuvvuc", khuVucId);
            $.ajax({
                url: "/Khuvuchoca/Laytoigian",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        var thoiGianConLai = response.time;
                        element.html(`${thoiGianConLai}`);
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Updatebamgio(KhuvucId) {
            var formData = new FormData();
            formData.append("Ma_khuvvuc", KhuvucId);
            $.ajax({
                url: "/Khuvuchoca/UpdateBamgio",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {

                        Swal.fire({
                            title: "Thành công",
                            text: "Bấm giờ thành công",
                            icon: "success"
                        });
                    }
                    else {
                        console.log("Thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Kiemtrabamgio(KhuvucId) {
            var formData = new FormData();
            formData.append("Ma_khuvvuc", KhuvucId);
            $.ajax({
                url: "/Khuvuchoca/KiemtraBamgio",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        var submitButton = document.getElementById('Bamgio');
                        submitButton.innerText = 'Dừng thời gian';
                        submitButton.id = 'dungtg';
                        document.getElementById('Bamgio').innerText = 'Dừng thời gian';

                    } else {
                        var submitButton = document.getElementById('dungtg');
                        submitButton.innerText = 'Bấm giờ';
                        submitButton.id = 'Bamgio';
                        document.getElementById('dungtg').innerText = 'Bấm giờ';
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Dungthoigian(KhuvucId) {
            var formData = new FormData();
            formData.append("Ma_khuvvuc", KhuvucId);
            $.ajax({
                url: "/Khuvuchoca/Dungthoigian",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {

                        Swal.fire({
                            title: "Thành công",
                            text: "Dừng thời gian thành công",
                            icon: "success"
                        });
                    }
                    else {
                        console.log("Thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Xoakhachang(KhuvucId) {
            var formData = new FormData();
            formData.append("Ma_khuvvuc", KhuvucId);
            $.ajax({
                url: "/Khuvuchoca/Xoakhachhang",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {

                        Swal.fire({
                            title: "Thành công",
                            text: response.messeger,
                            icon: "success"
                        });
                    }
                    else {
                        console.log("Thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        
        function Xoakhuvuc(KhuvucId) {
            var formData = new FormData();
            formData.append("Ma_khuvvuc", KhuvucId);
            $.ajax({
                url: "/Khuvuchoca/Xoakhuvuc",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {

                        Swal.fire({
                            title: "Thành công",
                            text: response.messeger,
                            icon: "success"
                        });
                    }
                    else {
                        console.log("Thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
       
       
        function Xemkhkhuvuc(KhuvucId) {
            var formData = new FormData();
            formData.append("Ma_khuvvuc", KhuvucId);
            $.ajax({
                url: "/Khuvuchoca/Laykhachthue",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    html = "";
                    if (response.success) {
                        $('#Ma_thuehoca').val(response.data.ma_thuehoca);

                        html += `<div><span>Tên khu vực:</span><span class="value">${response.data.ten_Khuvuccau}</span></div>`
                        html += `<div><span>Tên khách hàng:</span><span  class="value">${response.data.ten_khachhang}</span></div>`
                        html += `<div><span>Ngày câu:</span><span class="value">${response.data.ngaycau}</span></div>`
                        html += `<div><span>Thời gian bắt đầu câu:</span><span class="value">${response.data.thoigianbatdau}</span></div>`
                        html += `<div><span>Thời gian  câu:</span><span class="value">${response.data.timeout}</span></div>`
                        $('.customer-info').html(html);

                        // Cập nhật các biến toàn cục
                        tenKhachHang = response.data.ten_khachhang;
                        tenKhuvuc = response.data.ten_Khuvuccau;

                    }
                    else {
                        html += `<div><span class="value">Chưa có khách hàng hãy thêm khách hàng</span></div>`
                        $('.customer-info').html(html);
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Danhsachhs() {
            $.ajax({
                type: "POST",
                url: "/Haisan/Danhsachhaisan",
                success: function (response) {

                    if (response.success) {
                        $('#Ma_haisan').empty();
                        console.log(response.dsdm);
                        $.each(response.dsdm, function (index, value) {
                            var str = '';
                            var str = `  <option value="${value.ma_haisan}">${value.ten_haisan}</option>`

                            $('#Ma_haisan').append(str);

                        });
                    } else {
                        Swal.fire({
                            title: "Thông báo lỗi",
                            text: response.message,
                            icon: "error"
                        });
                    }
                }
            });
        }
        function Themcane() {
            var form = $("#formthemca")[0];
            var Ma_thuehoca = $("#Ma_thuehoca").val();
            var Ma_haisan = $("#Ma_haisan").val();
            var giocau = $("#giocau").val();
            var sokg = $("#sokg").val();
            var formData = new FormData();
            formData.append("Ma_thuehoca", Ma_thuehoca);
            formData.append("Ma_haisan", Ma_haisan);
            formData.append("giocau", giocau);
            formData.append("sokg", sokg);
            $.ajax({
                url: "/Chitietca/ThemCa",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.messege,
                            icon: "success"
                        });
                        form.reset();
                        $("#Themchitietca").modal("hide");
                        $("#Xemca").modal("show");
                        Danhsachca(kvc)
                        Tongsokg(kvc);
                        Tongtienhd(kvc);
                        Laytongtt(kvc);
                        form.reset();
                    } else {
                        Swal.fire({
                            title: "Thất bại",
                            text: response.messege,
                            icon: "error"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Danhsachca(khuvucId) {
            $.ajax({
                type: "POST",
                url: "/Chitietca/Danhsachca",
                data: { khuvucId: khuvucId },
                success: function (response) {

                    if (response.success) {

                        var html = '';
                        $('#dsca').empty();
                        $.each(response.data, function (index, value) {

                            var str = `<tr>
                                                            <td>${value.giocau}</td>
                                                            <td>${value.ten_haisan}</td>
                                                            <td>${value.sokg}</td>
                                                            <td>${formatCurrency(value.thanhtien)}</td>
                                                                <td><button class="btn btn-danger" data-id="${value.ma_chitietlancau}" onclick="Xoaca('${value.ma_chitietlancau}')" >Xóa</button></td>

                                                        </tr>`;
                            html += str; // Thêm chuỗi vào biến html
                        });
                        $('#dsca').html(html); // Append tất cả HTML đã tạo vào #dsca
                    } else {
                        Swal.fire({
                            title: "Thông báo lỗi",
                            text: response.message,
                            icon: "error"
                        });
                    }
                }
            });
        }
        function formatCurrency(value) {
            return value.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
        }
        function Tongsokg(khuvucId) {
            $.ajax({
                type: "POST",
                url: "/Chitietca/Sokgca",
                data: { khuvucId: khuvucId },
                success: function (response) {

                    var str = '';
                    if (response.success) {


                        $('.bill-total-kg').empty();


                        var str = `<h2>Tổng Trọng Lượng Cá Câu Được: <span class="text-danger"> ${response.data.sokg} kg</span></h2>`;
                        // Thêm chuỗi vào biến html

                        $('.bill-total-kg').html(str); // Append tất cả HTML đã tạo vào #dsca
                    } else {
                        var html = `<h2>Tổng Trọng Lượng Cá Câu Được: <span>0 kg</span></h2>`;
                        $('.bill-total').html(str);
                        Swal.fire({
                            title: "Thông báo lỗi",
                            text: response.message,
                            icon: "error"
                        });
                    }
                }
            });
        }
        function Xoaca(Ma_chitietlancau) {
            var formData = new FormData();
            formData.append("Ma_chitietlancau", Ma_chitietlancau);
            $.ajax({
                url: "/Chitietca/Xoaca",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.message,
                            icon: "success"
                        });
                        Danhsachca(kvc);
                        Tongsokg(kvc);
                    }
                    else {
                        console.log("Thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }

        function Danhsachdv() {
            $.ajax({
                type: "GET",
                url: "/Danhmuchoadon/Danhmucdv",
                success: function (response) {

                    if (response.success) {
                        console.log(response.data);
                        $.each(response.data, function (index, value) {
                            var str = '';
                            var str = `  <option value="${value.ma_danhmuc}" >${value.ten_danhmuc}</option>`

                            $('#Ma_danhmucdv').append(str);
                            $('#Ma_danhmucdv').trigger('change');;
                        });
                    } else {
                        Swal.fire({
                            title: "Thông báo lỗi",
                            text: response.message,
                            icon: "error"
                        });
                    }
                }
            });
        }
        function Themdichvu() {
            var form = $("#formthemdv")[0];
            var Ma_thuehoca = $("#Ma_thuehoca").val();
            var Ma_danhmuc = $("#Ma_danhmucdv").val();
            var soluong = $("#soluongdm").val();

            // Kiểm tra xem đã chọn danh mục chưa
            if (!Ma_danhmuc || Ma_danhmuc === "Chọn danh mục...") {
                Swal.fire({
                    title: "Thông báo",
                    text: 'Vui lòng chọn danh mục dịch vụ',
                    icon: "warning"
                });
                return; // Dừng hàm nếu chưa chọn danh mục
            }


            var formData = new FormData();
            formData.append("Ma_thuehoca", Ma_thuehoca);
            formData.append("Ma_danhmuc", Ma_danhmuc);
            formData.append("soluong", soluong);
            formData.append("Ma_khuvuc", kvc);
            $.ajax({
                url: "/Danhmuchoadon/Themdanhmuchd",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.message,
                            icon: "success"
                        });
                        Danhsachhddv(kvc);
                        hienthihanghoa()
                        $("#Themdichvu").modal("hide");
                        $("#Xemdichvu").modal("show");

                        form.reset();

                    } else {
                        Swal.fire({
                            title: "Thông báo",
                            text: 'Không đủ hàng hóa trong kho',
                            icon: "warning"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        //danh sách hóa đơn dịch vụ
        function Danhsachhddv(khuVucId) {
            $.ajax({
                type: "POST",
                url: "/Danhmuchoadon/Dsdmhd",
                data: { Ma_khuvuc: khuVucId },
                success: function (response) {

                    if (response.success) {

                        var html = '';
                        $('#dsdv').empty();
                        $.each(response.data, function (index, value) {
                            var str = `<tr>
                                                            <td>${value.ma_danhmuc}</td>
                                                            <td>${value.ten_danhmuc}</td>
                                                            <td>${value.dvt}</td>
                                                            <td><input class="form-control text-center form-control-sm" id="Soluong" type="number" value="${value.soluong}" data-id="${value.ma_danhmuchoadon}"></td>
                                                            <td>${formatCurrency(value.gia)}</td>
                                                            <td>${formatCurrency(value.thanhtien)}</td>
                                                            <td><button class="btn btn-danger" data-id="${value.ma_danhmuchoadon}" onclick="Xoadanhmuchoadon('${value.ma_danhmuchoadon}')" >Xóa</button></td>
                                                            </tr>`;
                            html += str; // Thêm chuỗi vào biến html
                        });
                        $('#dsdv').html(html);
                        
                        Tongsokghd(khuVucId);
                        danhsachcahd(khuVucId);
                        Tongtienhd(khuVucId);
                        



                    } else {
                        Swal.fire({
                            title: "Thông báo lỗi",
                            text: response.message,
                            icon: "error"
                        });
                    }
                }
            });
        }
        function Xoadanhmuchoadon(Ma_danhmuchoadon) {
            var formData = new FormData();
            formData.append("Ma_danhmuchoadon", Ma_danhmuchoadon);
            $.ajax({
                url: "/Danhmuchoadon/Xoadichvu",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.message,
                            icon: "success"
                        });
                        Danhsachhddv(kvc)
                        hienthihanghoa()
                    }
                    else {
                        console.log("Thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        // hiển thị cá trong danh sách hóa đơn
        function Tongsokghd(khuvucId) {
            $.ajax({
                type: "POST",
                url: "/Chitietca/Sokgca",
                data: { khuvucId: khuvucId },
                success: function (response) {
                    if (response.success) {

                        var html = `
                                            <tr>
                                                <td>DM0000</td>
                                                <td>Cá câu</td>
                                                <td>Kí</td>
                                                <td><input type="number" readonly class="form-control text-center" value="${response.data.sokg}"</td>
                                                        @* <td>${response.data.sokg}</td> *@
                                                                    <td>${formatCurrency(response.data.tongsotien)} </td>
                                                <td>${formatCurrency(response.data.tongsotien)}</td>

                                                        <td><button class="btn btn-danger" data-id="" onclick="" disabled>Xóa</button></td>
                                            </tr>`;
                        $('#dsdv').append(html);
                    } else {
                        Swal.fire({
                            title: "Thông báo lỗi",
                            text: response.message,
                            icon: "error"
                        });
                    }
                }
            });
        }
        function Danhsachcahd() {
            $.ajax({
                type: "GET",
                url: "/Danhmuchoadon/Danhsachca",
                success: function (response) {
                    if (response.success) {

                        $.each(response.data, function (index, value) {
                            var str = '';
                            var str = `  <option value="${value.ma_giahoca}">${value.ca} giờ</option>`
                            $('#Ma_giahoca').append(str);

                        });
                    } else {
                        Swal.fire({
                            title: "Thông báo lỗi",
                            text: response.message,
                            icon: "error"
                        });
                    }
                }
            });
        }
        function Themthoigian() {
            var form = $("#formthemtg")[0];
            var Ma_thuehoca = $("#Ma_thuehoca").val();
            var Ma_giahoca = $("#Ma_giahoca").val();
            var Soluong = $("#Soluonggio").val();
            var Trangthai = $("#Trangthai").val();
            var formData = new FormData();
            formData.append("Ma_giahoca", Ma_giahoca);
            formData.append("Soluong", Soluong);
            formData.append("Trangthai", Trangthai);
            formData.append("Ma_thuehoca", Ma_thuehoca);
            $.ajax({
                url: "/Danhmuchoadon/Themthoigian",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.message,
                            icon: "success"
                        });
                        Danhsachhddv(kvc);
                        $("#Themthoigian").modal("hide");
                        $("#Xemdichvu").modal("show");
                        form.reset();
                    } else {
                        Swal.fire({
                            title: "Thất bại",
                            text: response.message,
                            icon: "error"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function danhsachcahd(KhuvucId) {
            $.ajax({
                type: "POST",
                url: "/Danhmuchoadon/Danhsachthoigian",
                data: { khuvucId: KhuvucId },
                success: function (response) {
                    console.log(response.data);
                    if (response.success) {
                        var html = '';

                        $.each(response.data, function (index, value) {
                            var str = `<tr>
                                                                            <td>DM0000</td>
                                                                            <td>Dịch vụ câu</td>
                                                                            <td>${value.ca} Giờ</td>
                                                                            <td><input type="number" readonly class="form-control text-center" value="${value.soluong}"</td>
                                                                            <td>${value.giaca}</td>
                                                                            <td>${value.thanhtien}</td>
                                                                            <td><button class="btn btn-danger" data-id="${value.ma_giachothuehc}" onclick="Xoathoigian('${value.ma_giachothuehc}')" >Xóa</button></td>
                                                                    </tr>`;
                            html += str; // Thêm chuỗi vào biến html
                        });
                        $('#dsdv').append(html);
                        Tongsokghd(khuVucId);

                    } else {
                        Swal.fire({
                            title: "Thông báo lỗi",
                            text: response.message,
                            icon: "error"
                        });
                    }
                }
            });
        }
        function Xoathoigian(Ma_giachothuehc) {
            var formData = new FormData();
            formData.append("Ma_giachothuehc", Ma_giachothuehc);
            $.ajax({
                url: "/Danhmuchoadon/Xoathoigian",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.message,
                            icon: "success"
                        });
                        Danhsachhddv(kvc)
                    }
                    else {
                        console.log("Thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Tongtienhd(khuVucId) {
            $.ajax({
                type: "POST",
                url: "/Danhmuchoadon/Tongtienhd",
                data: { khuVucId: khuVucId },
                success: function (response) {
                    if (response.success) {
                        tongtienthanhtoan = response.tongthanhtoan;

                        Laytongtt(khuVucId);
                        Giacutt(tongtienthanhtoan);
                    } else {
                        console.log("Tổng tiền hợp đồng thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error: ", error);
                    Swal.fire({
                        title: "Thông báo lỗi",
                        text: "Đã xảy ra lỗi khi tải dữ liệu.",
                        icon: "error"
                    });
                }
            });
        }
        function Laytongtt(khuVucId) {
            $.ajax({
                type: "POST",
                url: "/Danhmuchoadon/Laytongthanhtoan",
                data: { khuVucId: khuVucId },
                success: function (response) {
                    if (response.success) {
                        tongtiencuoicung = response.data.tongthanhtoan;
                        $('.bill-total').empty();
                        var str = `<h6 class="fs-2">Tổng Tiền thanh toán: <span>${formatCurrency(response.data.tongthanhtoan)}</span></h6>`;
                        $('.bill-total').html(str);

                    } else {
                        console.log("Tổng tiền hợp đồng thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error: ", error);
                    Swal.fire({
                        title: "Thông báo lỗi",
                        text: "Đã xảy ra lỗi khi tải dữ liệu.",
                        icon: "error"
                    });
                }
            });
        }
        // giảm giá tiền hàng hóa
        function Giamgia() {
            var formData = new FormData();
            var giamgia = $("#discount-input").val();
            formData.append("Giamgiatien", giamgia);
            formData.append("Ma_khuvuc", kvc);
            $.ajax({
                url: "/Danhmuchoadon/Giamgia",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {

                        Laytongtt(kvc);

                    }
                    else {
                        console.log("Thất bại");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Giacutt(tongtienthanhtoan) {
            var totalStr = `<tr class="total-row">
                                            <td colspan="5" style="text-align:right; font-weight:bold;">Tổng tiền:</td>
                                                    <td style="font-weight:bold;">${formatCurrency(tongtienthanhtoan)}</td>
                                            <td></td>
                                        </tr>`;

            $('#dsdv').append(totalStr);
        }

       
        // bao gồm các button như giảm giá,tiền mặt và chuyển khoản
        @* function Cacbutton() {
            var totalStr = `
                    <tr>
                        <td colspan="6" style="text-align:right;">
                            <div class="d-flex align-items-center">
                                <span >
                                            <b> Giảm giá:&nbsp; </b>
                                </span>
                                        <input type="number" class="form-control hide-when-print" style="max-width: 350px;" id="discount-input">
                            </div>
                        </td>
                    </tr>
                    <tr>
                                    <td colspan="6" style="text-align:right;">
                                    <div class="d-flex align-items-center">
                                        <span>
                                                    <b> Tiền mặt:&nbsp;</b>
                                        </span>
                                                <input type="number" class="form-control hide-when-print" style="max-width: 350px;" id="tienmat">
                                    </div>
                                </td>
                    </tr>
                    <tr>
                        <td colspan="6" style="text-align:right;">
                            <div class="d-flex align-items-center">
                                <span>
                                            <b> Chuyển khoản:&nbsp;</b>
                                </span>
                                        <input type="number" class="form-control hide-when-print" style="max-width: 350px;" id="chuyenkhoan">
                            </div>
                        </td>
                    </tr>
                `;




            $('#dsdv').append(totalStr);
        } *@
        function parseCurrency(value) {

            return parseInt(value.replace(/[^0-9]/g, ''), 10);
        }
        function updateInputValue(input) {
            const value = parseInt(input.value.replace(/[^0-9]/g, ''), 10);
            if (!isNaN(value)) {
                input.value = formatCurrency(value);
            } else {
                input.value = '';
            }
        }
        function selectbancau() {
            var Ma_hoca = $("#Ma_hoca").val();
            $.ajax({
                url: "/Khuvuchoca/Danhsachkhuvucvang",
                type: "POST",
                data: { Ma_hocau: Ma_hoca },
                success: function (response) {

                    if (response.success) {
                        var str = '';
                        $.each(response.data, function (index, value) {
                            str += `<option value="${value.ma_Khuvuccau}">${value.ten_Khuvuccau}</option>`;
                        });
                        $('#Banmuonchuyen').html(str);
                    } else {
                        Swal.fire({
                            title: "Thất bại",
                            text: response.message,
                            icon: "error"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function Chuyenban() {
            var Ma_khuvucmoi = $("#Banmuonchuyen").val();
            var Ma_khuvuc = kvc;
            var formData = new FormData();
            formData.append("Ma_khuvucmoi", Ma_khuvucmoi);
            formData.append("Ma_khuvuc", Ma_khuvuc);
            $.ajax({
                url: "/Khuvuchoca/Chuyenbanthue",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.messeger,
                            icon: "success"
                        });

                        $("#Chuyenban").modal("hide");
                    } else {
                        Swal.fire({
                            title: "Thất bại",
                            text: response.messeger,
                            icon: "error"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        function danhsachNVKD(page, pagesize) {
    $.ajax({
        type: "GET",
        url: "/Quanlynguoidung/LayThongTinNguoiDungDaDangNhap", // Thay URL nếu cần
        data: { page: page, pagesize: pagesize },
        success: function (response) {
            $('#nhanvien').empty();

            if (response.success) {
            
                // Kiểm tra nếu response.users là một đối tượng đơn lẻ
                if (response.users) {
                    var value = response.users;
                    //var option = `<option value="${value.ma_user}" data-name="${value.hovaten}" selected>${value.hovaten}</option>`;
                    //$('#nhanvien').append(option);
                    $('#nhanvien').val(value.hovaten);
                    tenNVKD = value.hovaten;
                } else {
                    $('#nhanvien').append('<option value="">Không có người dùng nào</option>');
                }
            } else {
                Swal.fire({
                    title: "Thông báo lỗi",
                    text: response.message,
                    icon: "error"
                });
            }
        },
        error: function (xhr, status, error) {
            Swal.fire({
                title: "Thông báo lỗi",
                text: "Có lỗi xảy ra khi tải dữ liệu.",
                icon: "error"
            });
        }
    });
}
function Themphieuxuat() {
    // Lấy dữ liệu từ các trường
    var soPhieu = "";
    var ngayPhieu = new Date().toISOString();
    var tongTien = tongtiencuoicung || 0;
    var noCu = parseFloat($('input[name="noCu"]').val()) || 0;
    var thanhToan = parseFloat($('input[name="thanhToan"]').val()) || 0;
    var conLai = parseFloat($('input[name="conLai"]').val()) || 0;
    var hanThanhToan = new Date().toISOString();
    var ghiChu = "";
    var giamGia = discountValue || 0;
    var tienMat = cashValue || 0;
    var chuyenKhoan = transferValue || 0;

    var chiTietPhieuXuats = [];
    $('#dsdv tr').each(function() {
        var row = $(this);
         if (row.hasClass('total-row')) {
            return;
        }
        var maSanPham = row.find('td:eq(0)').text();
        var tenSanPham = row.find('td:eq(1)').text();
        var donViTinh = row.find('td:eq(2)').text();
        var soLuong = parseFloat(row.find('td:eq(3) input').val()) || 0;
        var donGia = parseInt(row.find('td:eq(4)').text().replace(/[^\d]/g, '')) || 0;
        var thanhTien = parseInt(row.find('td:eq(5)').text().replace(/[^\d]/g, '')) || 0;

        chiTietPhieuXuats.push({
            SoPhieu: soPhieu,
            Ma_sanpham: maSanPham,
            TenSanPham: tenSanPham,
            SoLuong: soLuong,
            DonGia: donGia,
            DonViTinh: donViTinh,
            ThanhTien: thanhTien
        });
    });

    var dataToSend = {
        SoPhieu: soPhieu,
        NgayPhieu: ngayPhieu,
        TenKhachHang: tenKhachHang,
        TenNVKD: tenNVKD,
        TongTien: tongTien,
        NoCu: noCu,
        ThanhToan: thanhToan,
        ConLai: conLai,
        HanThanhToan: hanThanhToan,
        GhiChu: ghiChu,
        GiamGia: giamGia,
        TienMat: tienMat,
        ChuyenKhoan: chuyenKhoan,
        TenKhuvuc: tenKhuvuc,
        ChiTietPhieuXuats: chiTietPhieuXuats
    };

    console.log("data",dataToSend); // Kiểm tra dữ liệu trước khi gửi

    $.ajax({
        url: "/api/PhieuXuat/ThemPhieuXuatHocau",
        type: "POST",
        data: JSON.stringify(dataToSend),
        contentType: "application/json",
        success: function (response) {
            if (response.success) {
                console.log("Thành công");
                Swal.fire({
                    title: "Thành công",
                    text: "Xuất phiếu thành công!",
                    icon: "success"
                });
            } else {
                Swal.fire({
                    title: "Thất bại",
                    text: response.messeger,
                    icon: "error"
                });
            }
        },
        error: function (xhr, status, error) {
            console.log(xhr.responseText); // In ra lỗi chi tiết
            Swal.fire({
                title: "Lỗi",
                text: "Đã xảy ra lỗi khi gửi yêu cầu.",
                icon: "error"
            });
        }
    });
    Inhoadon();
}
        
        function Kiemtrabamgioin(KhuvucId) {
            var formData = new FormData();
            formData.append("Ma_khuvvuc", KhuvucId);
            $.ajax({
                url: "/Khuvuchoca/KiemtraBamgio",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Lỗi!!!",
                            text: "Bạn hãy dừng bấm giờ",
                            icon: "error"
                        });
                    }
                    else {
                        Themphieuxuat();

                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        // in hóa đơn
        function Inhoadon() {
            var printContents = document.querySelector("#Xemdichvu #in").innerHTML;
            var originalContents = document.body.innerHTML;

            // Lấy giá trị các input, kiểm tra và chuyển đổi sang định dạng tiền tệ
            discountValue = document.getElementById('discount-input').value || 0;
            cashValue = document.getElementById('tienmat').value || 0;
            transferValue = document.getElementById('chuyenkhoan').value || 0;

            var giamgia = formatCurrency1(discountValue);
            var tienmat = formatCurrency1(cashValue);
            var chuyenkhoan = formatCurrency1(transferValue);

            // Thay thế các input bằng các thẻ span
            printContents = printContents.replace(/<input[^>]*id="discount-input"[^>]*>/, `<span>${giamgia}</span>`);
            printContents = printContents.replace(/<input[^>]*id="tienmat"[^>]*>/, `<span>${tienmat}</span>`);
            printContents = printContents.replace(/<input[^>]*id="chuyenkhoan"[^>]*>/, `<span>${chuyenkhoan}</span>`);
            printContents = printContents.replace(/<button[^>]*id="apply-discount-btn"[^>]*>[\s\S]*?<\/button>/gi, '<span><b>Giảm giá:</b> </span>');
            printContents = printContents.replace(/<input[^>]*id="Soluong"[^>]*>/g, function (match) {
                // Trích xuất giá trị "value" từ input
                const valueMatch = match.match(/value="([^"]*)"/);
                const soluong = valueMatch ? valueMatch[1] : '';

                // Trả về thẻ <span> thay thế cho thẻ <input>
                return `${soluong}`;
            });


            // Loại bỏ cột "Xóa" từ nội dung cần in
            printContents = printContents.replace(/<th>Xóa<\/th>/g, ''); // Xóa tiêu đề cột "Xóa"
            printContents = printContents.replace(/<td>.*?<\/td>\s*<\/tr>/g, '</tr>'); // Xóa ô dữ liệu trong cột "Xóa"

            // Loại bỏ tất cả các nút button liên quan đến xóa
            printContents = printContents.replace(/<button.*?delete.*?<\/button>/gi, ''); // Xóa tất cả các nút button liên quan đến xóa

            // Thêm các kiểu in
            var printStyles = `
                                <style>
                                    body {
                                        font-family: Arial, sans-serif;
                                        color: #000;
                                    }
                                    .bill-container {
                                        font-family: Arial, sans-serif;
                                        color: #000;
                                        padding: 40px; /* Tăng padding */
                                        width: 150mm; /* Tăng chiều rộng cho hóa đơn */
                                        margin: 0 auto;
                                        border: 1px solid #ddd;
                                        border-radius: 5px;
                                        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                                    }
                                    .bill-container .discount-section{
                                        display:none;
                                    }
                                    .store-info, .bill-header, .customer-info, .bill-footer {
                                        margin-bottom: 25px; /* Tăng khoảng cách giữa các phần */
                                        text-align: center;
                                    }
                                    .store-info strong, .bill-header strong {
                                        display: block;
                                        font-size: 1.8em; /* Tăng kích thước chữ */
                                        margin-bottom: 15px; /* Tăng khoảng cách dưới */
                                    }
                                    .bill-description {
                                        text-align: center;
                                        font-size: 1.4em; /* Tăng kích thước chữ */
                                        margin-bottom: 25px; /* Tăng khoảng cách dưới */
                                    }
                                    .customer-info div, .bill-footer div {
                                        font-size: 1.3em; /* Tăng kích thước chữ */
                                        margin-bottom: 15px; /* Tăng khoảng cách dưới */
                                    }
                                    .bill-details table {
                                        width: 100%;
                                        border-collapse: collapse;
                                        margin-bottom: 35px; /* Tăng khoảng cách dưới */
                                    }
                                    .bill-details th, .bill-details td {
                                        border: 1px solid #000;
                                        padding: 12px; /* Tăng padding */
                                        text-align: left;
                                        font-size: 1.2em; /* Tăng kích thước chữ */
                                    }
                                    .bill-details th {
                                        background-color: #f2f2f2;
                                        text-align: center;
                                    }
                                    .bill-footer {
                                        text-align: right;
                                        font-size: 1.3em; /* Tăng kích thước chữ */
                                    }
                                    .signatures {
                                        display: flex;
                                        justify-content: space-between;
                                        margin-top: 50px; /* Tăng khoảng cách trên */
                                        font-size: 1.3em; /* Tăng kích thước chữ */
                                        text-align: center;
                                    }
                                </style>
                            `;
            
            window.addEventListener('afterprint', function () {
                // Gộp nội dung và kiểu in thành một chuỗi HTML
               var htmlInvoice = printStyles + printContents;
               // var dsdv = document.getElementById('dsdv').innerHTML;
                Xoakhachang(kvc);
                location.reload();
            });

            // Gộp nội dung và in
            document.body.innerHTML = printStyles + printContents;
            window.print();
            document.body.innerHTML = originalContents;
        }
        // hàm lấy hàng hóa hiển thị trong hóa đơn
       function hienthihanghoa(Ma_mathang) {
    $.ajax({
        type: "POST",
        url: "/Khuvuchoca/Danhmuchthd",
        data: { Ma_mathang: Ma_mathang },
        success: function (reponser) {
            if (reponser.success) {
                var html = '';
                $('#danhmuc-list , #danhmuc-list2 ').empty();
                $.each(reponser.data, function (index, value) {
                    var selectButton = ''; // Tạo một chuỗi rỗng cho nút "Chọn"
                    
                    // Nếu số lượng > 0, hiển thị nút "Chọn"
                    if (value.soluong > 0) {
                        selectButton = `<button class="btn btn-primary btn-sm select-item" id="btnChondm" data-id="${value.ma_danhmuc}">Chọn</button>
                                        `
                    } else {
                        selectButton = '<span class="text-danger">Hết hàng</span>';
                    }

                    // Tạo chuỗi HTML cho từng hàng trong bảng
                    var str = `<tr>
                                <td>${value.ma_danhmuc}</td>
                                <td>${value.ten_danhmuc}</td>
                                <td>${value.soluong}</td>
                                <td>${formatCurrency(value.gia)}</td>
                                <td>${value.donvitinh}</td>
                                <td>${selectButton}</td>
                               </tr>`;
                    
                    html += str; // Thêm chuỗi vào biến html
                });
                $('#danhmuc-list , #danhmuc-list2').html(html); // Cập nhật nội dung bảng
                console.log(reponser);
            } else {
                Swal.fire({
                    title: "Thông báo lỗi",
                    text: response.message,
                    icon: "error"
                });
            }
        }
         });
    }

        // hàm lấy hàng hóa hiển thị trong hóa đơn
        function Mathanghthd() {
            $.ajax({
                type: "GET",
                url: "/Khuvuchoca/Mathanghthd",
                processData: false,
                contentType: false,
                success: function (reponser) {
                    if (reponser.success) {

                        var html = '';
                        $('#Ma_mathang').empty();
                        $.each(reponser.data, function (index, value) {
                            var str = `<option value="${value.ma_mathang}">${value.ten_mathang}</option>`;
                            html += str; // Thêm chuỗi vào biến html
                        });
                        $('#Ma_mathang').html(html);
                    }
                    else {
                        Swal.fire({
                            title: "Thông báo lỗi",
                            text: response.message,
                            icon: "error"
                        });
                    }
                }
            })
        }
        // Hàm lấy thêm dịch vụ hóa đơn theo list
        function Themdichvuhd(ma_danhmuc) {

            var Ma_thuehoca = $("#Ma_thuehoca").val();
            var formData = new FormData();
            formData.append("Ma_nguoithue", Ma_thuehoca);
            formData.append("Ma_danhmuc", ma_danhmuc);
            formData.append("Ma_khuvuccau", kvc);
            $.ajax({
                url: "/Danhmuchoadon/Themdanhmuchdlst",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    console.log(response);
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.message,
                            icon: "success"
                        });

                        Danhsachhddv(kvc);
                        hienthihanghoa();
                        $("#Themdichvu").modal("hide");
                        $("#Xemdichvu").modal("show");
                        $('#Timkiem').focus();
                        form.reset();

                    } else {
                        Swal.fire({
                            title: "Thất bại",
                            text: response.message,
                            icon: "error"
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        // hàm cập nhật số lượng hàng hóa
        function Capnhatsoluong(ma_danhmuchoadon, soluong) {

            $.ajax({
                url: "/Danhmuchoadon/Capnhatsoluonghd",
                type: "POST",
                data: { ma_danhmuchoadon: ma_danhmuchoadon, soluong: soluong },
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Thành công",
                            text: response.message,
                            icon: "success"
                        });
                        Danhsachhddv(kvc);
                        hienthihanghoa();
                        form.reset();
                    } else {
                        Swal.fire({
                            title: "Thông báo",
                            text: 'Số lượng không đủ',
                            icon: "warning"
                        });
                         Danhsachhddv(kvc);
                        hienthihanghoa();
                        form.reset();
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    console.log(xhr.responseText);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.hehe");
                }
            });
        }
        // hàm tính tiền cho khách 
        function Tinhtienthua() {

            var html = '';
            var giamgia = $("#discount-input").val()||0;
            var tienmat = $("#tienmat").val()||0;
            var chuyenkhoan = $("#chuyenkhoan").val()||0;
            var tongtien = tongtienthanhtoan;
            tienthua = tongtien - tienmat - giamgia - chuyenkhoan;

            if (tienthua < 0) {
        // Tiền thối khách
        html = `<h6 class="fs-2">Tiền thối khách: <span class="text-success">${formatCurrency(Math.abs(tienthua))}</span></h6>`;
        } else if (tienthua > 0) {
        // Tiền khách thiếu
        html = `<h6 class="fs-2">Tiền khách thiếu: <span class="text-danger">${formatCurrency(tienthua)}</span></h6>`;
        } else {
        // Đã đủ tiền, không thối hoặc thiếu
        html = `<h6 class="fs-2">Khách đã thanh toán đủ.</h6>`;
        }

        $(".Tienthoichokhach").html(html);
        }
       
        // function filter
        function filterTable() {
            const searchInput = document.getElementById("search");
            const searchText = searchInput.value.toLowerCase();
            const rows = document.querySelectorAll("#danhmuc-list tr");

            rows.forEach((row) => {
                const cells = row.querySelectorAll("td");
                let match = false;

                cells.forEach((cell) => {
                    if (cell.textContent.toLowerCase().includes(searchText)) {
                        match = true;
                    }
                });

                row.style.display = match ? "table-row" : "none";
            });
        }


        // hàm cập nhật số lượng hàng hóa
        function Capnhatsoluonghh(ma_khuvuccau) {
            console.log("Mã khu vực cầu:", ma_khuvuccau);
            $.ajax({
                url: "/Danhmuc/Capnhatsoluong",
                type: "POST",
                data: { ma_khuvuccau: ma_khuvuccau },

                success: function (response) {
                    console.log("Phản hồi từ server:", response);
                    if (response.success) {
                        console.log("Thành công");

                    } else {
                        console.log("Cập nhật số lượng thất bại:", response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Có lỗi xảy ra: ", error);
                    console.error("Chi tiết lỗi:", xhr.responseText);
                    alert("Đã xảy ra lỗi trong quá trình gửi yêu cầu.");
                }
            });
        }
        // Thêm sự kiện keyup cho ô tìm kiếm
        document.getElementById("search").addEventListener("keyup", filterTable);
        function filterDichvu() {
    var searchText = $('#Ten_dichvu').val().toLowerCase(); // Lấy giá trị tìm kiếm và chuyển đổi thành chữ thường

    $.ajax({
        type: "GET",
        url: "/Danhmuchoadon/Danhmucdv", // URL của bạn để lấy danh sách dịch vụ
        success: function (response) {
            $('#tblbodyDichvu').empty(); // Xóa các mục trước đó

            if (response.success) {
                var filteredItems = response.data.filter(function (item) {
                    return item.ten_dichvu.toLowerCase().includes(searchText); // Lọc dựa trên giá trị tìm kiếm
                });

                if (filteredItems.length > 0) {
                    $.each(filteredItems, function (index, value) {
                        var str = `
                            <tr onclick="selectDichvu('${value.ma_dichvu}', '${value.ten_dichvu}', '${value.gia}', '${value.donvitinh}')">
                                <td>${value.ma_dichvu}</td>
                                <td>${value.ten_dichvu}</td>
                                <td>${value.donvitinh}</td>
                                <td>$${value.gia}</td>
                            </tr>`;
                        $('#tblbodyDichvu').append(str);
                    });
                    $('#dichvuList').show();
                } else {
                    $('#dichvuList').hide();
                }

            } else {
                Swal.fire({
                    title: "Thông báo lỗi",
                    text: response.message,
                    icon: "error"
                });
            }
        }
    });
}

// Hàm xử lý khi chọn một dịch vụ từ danh sách
function selectDichvu(maDichvu, tenDichvu, gia, donvitinh) {
    $('#Ten_dichvu').val(tenDichvu);
    $('#dichvuList').hide();
}

// Ẩn danh sách khi nhấp ra ngoài
$(document).click(function (event) {
    if (!$(event.target).closest('#Ten_dichvu, #dichvuList').length) {
        $('#dichvuList').hide();
    }
});


  // Hàm lọc danh mục dựa trên ô input
function filterDichvuList() {
    var searchText = $('#Ma_danhmuchoadon').val().toLowerCase();

    $.ajax({
        type: "GET",
        url: "/Danhmuchoadon/Danhmucdv",
        success: function (response) {
            $('#tblbody').empty();
            if (response.success) {
                var filteredItems = response.data.filter(function (item) {
                    return item.ten_danhmuc.toLowerCase().includes(searchText);
                });

                if (filteredItems.length > 0) {
                    $.each(filteredItems, function (index, value) {
                        var str = `
                            <tr onclick="selectItem('${value.ma_danhmuc}', '${value.ten_danhmuc}')">
                                <td>${value.ma_danhmuc}</td>
                                <td>${value.ten_danhmuc}</td>
                            </tr>`;
                        $('#tblbody').append(str);
                    });
                    $('#dichvuList').show();
                } else {
                    $('#dichvuList').hide();
                }
            } else {
                console.error("Lỗi khi lấy danh sách dịch vụ:", response.message);
            }
        },
        error: function (xhr, status, error) {
            console.error("Lỗi AJAX:", error);
        }
    });
}
// Hàm xử lý khi chọn một item từ danh sách
function selectItem(maDanhmuc, tenDanhmuc) {
    $('#Ma_danhmuchoadon').val(tenDanhmuc);
    $('#Ma_danhmucdv').val(maDanhmuc).trigger('change');
    $('#dichvuList').hide();
}

// Thêm sự kiện input cho ô tìm kiếm
$('#Ma_danhmuchoadon').on('input', filterDichvuList);


    </script>

}